{% extends 'base.html' %}
{% load humanize %}
{% block content %}

<!-- Header-->
<header class="bg-dark py-5">
    <div class="container px-4 px-lg-5 my-5">
        <div class="text-center text-white">
            <h1 class="display-4 fw-bolder">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ğŸ›’</h1>
            <p class="lead fw-normal text-white-50 mb-0">Ø§ÛŒÙ†Ø¬Ø§ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù…Ù† Ø§Ø³Øª.</p>
        </div>
    </div>
</header>

<div class="container mt-5" dir="rtl">

  {% if cart_products %}
  <div class="table-responsive">
    <table class="table align-middle table-bordered text-center">
      <thead class="table-success">
        <tr>
          <th scope="col">Ø±Ø¯ÛŒÙ</th>
          <th scope="col">ØªØµÙˆÛŒØ±</th>
          <th scope="col">Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</th>
          <th scope="col">Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯</th>
          <th scope="col">ØªØ¹Ø¯Ø§Ø¯</th>
          <th scope="col">Ø¬Ù…Ø¹ Ú©Ù„</th>
          <th scope="col">Ø­Ø°Ù</th>
        </tr>
      </thead>
      <tbody>
        {% for item in cart_products %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>
            <img src="{{ item.picture.url }}" width="90" height="60" class="rounded">
          </td>
          <td>{{ item.name }}</td>
          <td>{{ item.price }} ØªÙˆÙ…Ø§Ù†</td>
          <td>
            <div class="d-flex justify-content-center align-items-center">

                <input type="number" id="input{{item.id}}"
                   {% for key,value in quantities.items %}
                    {% if key == item.id|slugify %}
                   value="{{ value }}"
                    {% endif %}
                   {% endfor %}
                   class="form-control form-control-sm text-center mx-2 update-qty" style="width: 50px;">

              <button class="btn btn-outline-secondary btn-sm decrease-qty update-cart"
                      data-index="{{ item.id }}">ÙˆÛŒØ±Ø§ÛŒØ´</button>
            </div>
          </td>
          <td>{{ item.price }} ØªÙˆÙ…Ø§Ù†</td>
          <td>
            <button type="button" class="btn btn-sm btn-outline-danger delete-product"
            data-index="{{ item.id }}">
              Ø­Ø°Ù
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

<!--Ù…Ø¬Ù…ÙˆØ¹ Ú©Ù„ Ùˆ Ø§Ø¯Ø§Ù…Ù‡ ÙØ±Ø§ÛŒÙ†Ø¯ Ø®Ø±ÛŒØ¯-->

  {% else %}
  <div class="alert alert-warning text-center mt-5">
    ğŸ›ï¸ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª!
    <a href="{% url 'home' %}" class="alert-link">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</a>
  </div>
  {% endif %}
</div>

<script>
    $(document).on('click','.update-cart', function(e){
        e.preventDefault();
        var productid = $(this).data('index');
        var newQty = $('#input' + productid).val();
        $.ajax({
            type:'POST',
            url:'{% url 'cart_update' %}',
            data:{
                product_id: productid,
                product_qty: newQty,
                csrfmiddlewaretoken:'{{ csrf_token }}',
                action:'post'
            },
            success:function(json){
                document.getElementById('cart-quantity').textContent = json.qty;
                location.reload();
            },
            error:function(xhr, errmsg, err){

            }
        })
    })


        $(document).on('click','.delete-product', function(e){
        e.preventDefault();

        $.ajax({
            type:'POST',
            url:'{% url 'cart_delete' %}',
            data:{
                product_id: $(this).data('index'),
                csrfmiddlewaretoken:'{{ csrf_token }}',
                action:'post'
            },
            success:function(json){
                document.getElementById('cart-quantity').textContent = json.qty;
                location.reload();
            },
            error:function(xhr, errmsg, err){

            }
        })
    })

</script>

{% endblock %}
